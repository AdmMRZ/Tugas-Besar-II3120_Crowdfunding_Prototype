{% extends 'main/base.html' %}
{% load rupiah_filters %}

{% block content %}

<style>
    .fade-in-card { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>

<div class="row justify-content-center mb-5">
    <div class="col-md-8 text-center">
        
        <div class="input-group input-group-lg shadow-sm rounded-pill overflow-hidden mb-4">
            <span class="input-group-text bg-white border-0 ps-4">
                <i class="bi bi-search text-muted"></i>
            </span>
            <input type="text" id="search-input" class="form-control border-0" 
                   placeholder="Search campaigns instantly..." 
                   value="{{ request.GET.q|default:'' }}">
        </div>

        <div class="d-flex flex-wrap justify-content-center gap-2" id="category-container">
            <button data-cat="" class="category-btn btn btn-sm rounded-pill px-3 fw-bold btn-dark text-white">
                All Categories
            </button>
            
            {% for code, name in categories %}
            <button data-cat="{{ code }}" class="category-btn btn btn-sm rounded-pill px-3 fw-bold btn-light text-dark border">
                {{ name }}
            </button>
            {% endfor %}
        </div>
    </div>
</div>

<div id="campaign-container">
    {% include 'main/campaign_list.html' %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const categoryBtns = document.querySelectorAll('.category-btn');
    const container = document.getElementById('campaign-container');
    
    let currentCategory = '';
    let searchTimeout;

    function fetchCampaigns() {
        const query = searchInput.value;
        const url = `{% url 'campaign_index' %}?q=${query}&category=${currentCategory}`;

        container.style.opacity = '0.5';

        fetch(url, {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(response => response.text())
        .then(html => {
            container.innerHTML = html;
            container.style.opacity = '1'; 
        });
    }

    searchInput.addEventListener('keyup', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(fetchCampaigns, 300); 
    });

    categoryBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            categoryBtns.forEach(b => {
                b.classList.remove('btn-dark', 'text-white');
                b.classList.add('btn-light', 'text-dark');
            });
            this.classList.remove('btn-light', 'text-dark');
            this.classList.add('btn-dark', 'text-white');

            currentCategory = this.getAttribute('data-cat');
            fetchCampaigns();
        });
    });
});
</script>

{% endblock %}